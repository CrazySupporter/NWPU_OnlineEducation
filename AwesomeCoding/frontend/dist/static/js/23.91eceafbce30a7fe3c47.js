webpackJsonp([23],{GFwp:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),l=a.n(i),s={data:function(){return{table_name:"",heads:[{idx:"nickname",title:"昵称"},{idx:"realname",title:"真实姓名"},{idx:"email",title:"邮箱"},{idx:"role_title",title:"角色"}],table_data:[],input:{table_name:"users",items:{}},edit_dialog:{visual:!1,row:{}},loadingQ:!1,loadedQ:!1,display_config:{width:"1000px",margin:"auto",padding:"5px",overflow:"auto"},ruleForm:{fileList:[]},fileList:[],active_name:"class-users",blacklisting_data:[],black:{loadedQ:!1,loadingQ:!1,heads:[{idx:"user_id",title:"用户id"},{idx:"realname",title:"真实姓名"},{idx:"date_time",title:"拉黑时间"}]}}},props:["course_status","table_width"],computed:{fancy_data:function(){var t=[],e=!0,a=!1,i=void 0;try{for(var s,n=l()(this.table_data);!(e=(s=n.next()).done);e=!0){var o=s.value;0===o.role?o.role_title="教师":1===o.role?o.role_title="助教":2===o.role&&(o.role_title="学生"),t.push(o)}}catch(t){a=!0,i=t}finally{try{!e&&n.return&&n.return()}finally{if(a)throw i}}return t}},mounted:function(){this.table_width&&(this.display_config.width=this.table_width),this.class_id=this.$route.params.class_id,this.refreshParticipants(),this.refreshBlacklisting()},methods:{refreshParticipants:function(){var t=this;this.loadingQ=!0,this.$http.post("/api/class/participants/show",{class_id:this.class_id},null).then(function(e){t.table_data=e.body.results,t.loadingQ=!1,t.loadedQ=!0}).catch(function(e){t.loadingQ=!1,t.loadedQ=!0,"NOT_LOGIN."===e.body.details?t.$message("请登录..."):"NOT_IN_CLASS."===e.body.details?t.$message("请先加入班级"):t.$message("未知错误")})},refreshBlacklisting:function(){var t=this;this.black.loadingQ=!0,this.$http.post("/api/class/participants/show_blacklisting",{class_id:this.class_id}).then(function(e){t.black.loadingQ=!1,t.black.loadedQ=!0,t.blacklisting_data=e.body.results}).catch(function(e){t.black.loadingQ=!1,t.black.loadedQ=!0,console.log("[Participants]",e)})},handleAdd:function(){this.loadingQ=!0},handleDelete:function(t,e,a){var i=this;this.$confirm("真的要将"+e+"移出教室吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){return i.loadingQ=!0,i.$http.post("/api/class/participants/delete",{class_id:i.class_id,user_id:t},null)}).then(function(){i.$message.success("成功"),i.loadingQ=!1,i.table_data.splice(a,1),i.refreshBlacklisting()}).catch(function(){i.$message.error("失败"),i.loadingQ=!1})},handleAssignTA:function(t,e){var a=this;this.loadingQ=!0,this.$http.post("/api/class/participants/assignTA",{class_id:this.class_id,user_id:t},null).then(function(){a.$message.success("成功"),a.loadingQ=!1,a.table_data[e].role=1}).catch(function(){a.$message.error("失败"),a.loadingQ=!1})},handleCancelTA:function(t,e){var a=this;this.loadingQ=!0,this.$http.post("/api/class/participants/cancelTA",{class_id:this.class_id,user_id:t},null).then(function(){a.$message("成功"),a.loadingQ=!1,a.table_data[e].role=2}).catch(function(){a.$message("失败"),a.loadingQ=!1})},handleChange:function(){this.loadingQ=!0,this.edit_dialog.visual=!1},successUpload:function(t,e,a,i){var l=this;this.loadingQ=!0,this.$http.post("/api/class/addstudents",{class_id:this.class_id,filename:t.filename},null).then(function(t){"SUCCESS."===t.body.status?(l.$message("成功"),l.loadingQ=!1):("NO STUDENTS FILE"===t.body.details&&l.$message("请上传xlsx文件"),"NOT TEACHER"===t.body.details&&l.$message("您的身份没有导入学生的权限"),l.loadingQ=!1)}).catch(function(t){"NO STUDENTS FILE"===t.body.details&&l.$message("请上传一个xlsx文件"),"NOT TEACHER"===t.body.details&&l.$message("您的身份没有导入学生的权限"),l.loadingQ=!1})},handleCancelBlacklisting:function(t,e){var a=this;this.black.loadingQ=!0,this.$http.post("/api/class/participants/white",{class_id:this.class_id,user_id:t}).then(function(t){a.black.loadingQ=!1,a.$message("取消拉黑成功。"),a.blacklisting_data.splice(e,1)}).catch(function(t){a.black.loadingQ=!1,a.$message("取消失败，见console"),console.log(t)})}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-collapse",{model:{value:t.active_name,callback:function(e){t.active_name=e},expression:"active_name"}},[a("el-collapse-item",{attrs:{title:"班级成员",name:"class-users"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingQ,expression:"loadingQ"}],attrs:{id:"DataVisualizer"}},[t.loadedQ?a("div",[a("el-table",{style:t.display_config,attrs:{id:"display-table",data:t.fancy_data,"highlight-current-row":"",stripe:""}},[t._l(t.heads,function(t){return a("el-table-column",{key:t.idx,attrs:{label:t.title,align:"center",sortable:"",prop:t.idx}})}),t._v(" "),2!==t.course_status.role?a("el-table-column",{attrs:{align:"center",label:"移出教室"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.role>0?a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){t.handleDelete(e.row.id,e.row.realname,e.$index)}}}):t._e()]}}])}):t._e(),t._v(" "),0===t.course_status.role?a("el-table-column",{attrs:{align:"center",label:"指定助教"},scopedSlots:t._u([{key:"default",fn:function(e){return[2===e.row.role?a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(a){t.handleAssignTA(e.row.id,e.$index)}}}):t._e()]}}])}):t._e(),t._v(" "),0===t.course_status.role?a("el-table-column",{attrs:{align:"center",label:"取消助教"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.role?a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(a){t.handleCancelTA(e.row.id,e.$index)}}}):t._e()]}}])}):t._e()],2)],1):t._e(),t._v(" "),2!==t.course_status.role?a("div",{staticClass:"item"},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm}},[a("el-form-item",[a("el-upload",{staticClass:"upload-demo",attrs:{action:"/api/file/import","on-success":t.successUpload,"file-list":t.fileList}},[a("el-tooltip",{attrs:{content:"请上传一个xlsx文件，文件中应含有需导入学生的真实姓名"}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v("导入名单\n                                    ")])],1)],1)],1)],1)],1):t._e()])]),t._v(" "),a("el-collapse-item",{attrs:{title:"黑名单",name:"blacklisting"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.black.loadingQ,expression:"black.loadingQ"}],attrs:{id:"Blacklisting"}},[t.black.loadedQ?a("div",[a("el-table",{style:t.display_config,attrs:{id:"blacklisting-table",data:t.blacklisting_data,"highlight-current-row":"",stripe:""}},[t._l(t.black.heads,function(t){return a("el-table-column",{key:t.idx,attrs:{label:t.title,align:"center",prop:t.idx}})}),t._v(" "),t.course_status.role<2?a("el-table-column",{attrs:{align:"center",label:"取消拉黑"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"warning",icon:"el-icon-remove-outline",circle:""},on:{click:function(a){t.handleCancelBlacklisting(e.row.user_id,e.$index)}}})]}}])}):t._e()],2)],1):t._e()])])],1)],1)},staticRenderFns:[]};var o=a("VU/8")(s,n,!1,function(t){a("zrbe")},"data-v-13b40a2d",null);e.default=o.exports},zrbe:function(t,e){}});
//# sourceMappingURL=23.91eceafbce30a7fe3c47.js.map