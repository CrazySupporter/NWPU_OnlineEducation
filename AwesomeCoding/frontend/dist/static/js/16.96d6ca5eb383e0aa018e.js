webpackJsonp([16],{"03dj":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("mvHQ"),o=n.n(i),l=n("1EKI"),a=(n("vlrw"),{data:function(){return{index:null,visible:!1,loading:!1,title:null,info:{code:null,choice_count:4,description:null,solution:null,choice_A:null,choice_B:null,choice_C:null,choice_D:null,choice_E:null}}},computed:{choice_range:function(){for(var e=[],t=0;t<this.info.choice_count;t++)e.push(String.fromCharCode("A".charCodeAt()+t));return e}},methods:{handleOpen:function(e,t){var n=this;this.info.code=t.code,this.title=t.title,this.state=t.state,this.index=e,this.visible=!0,this.loading=!0,this.$http.post("/api/problem/table/choice_problems/get",{code:t.code}).then(function(e){n.info=e.body.results[0],n.loading=!1}).catch(function(e){n.loading=!1,n.$message("Cannot get the problem details...")})},handleCancel:function(){this.visible=!1},handleChecked:function(){var e=this;this.$http.post("/api/problem/table/choice_problems/save",{code:this.info.code,info:this.info}).then(function(t){e.$emit("completed",{index:e.index,info:e.info,state:e.state,title:e.title}),e.visible=!1}).catch(function(t){e.visible=!1})},handleClose:function(e){var t=this;this.$confirm("确认关闭？").then(function(n){t.visible=!1,e()}).catch(function(e){})}},components:{}}),s={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"新建选择题",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[n("el-form",{attrs:{model:e.info}},[n("el-form-item",{attrs:{label:"题目编号","label-width":"120px"}},[n("el-input",{attrs:{autocomplete:"off",disabled:""},model:{value:e.info.code,callback:function(t){e.$set(e.info,"code",t)},expression:"info.code"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"题目名称","label-width":"120px"}},[n("el-input",{model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"选项个数","label-width":"120px"}},[n("el-input-number",{attrs:{min:2,max:5},model:{value:e.info.choice_count,callback:function(t){e.$set(e.info,"choice_count",t)},expression:"info.choice_count"}})],1),e._v(" "),e._l(e.choice_range,function(t){return n("el-form-item",{key:t.index,attrs:{label:"选项"+t,"label-width":"120px"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.info["choice_"+t],callback:function(n){e.$set(e.info,"choice_"+t,n)},expression:"info['choice_'+item]"}})],1)})],2),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleChecked}},[e._v("保 存")])],1)],1)},staticRenderFns:[]},r=n("VU/8")(a,s,!1,null,null,null).exports,c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"新建编程题",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[n("el-form",[n("el-form-item",{attrs:{label:"题目编号","label-width":"120px"}},[n("el-input",{attrs:{autocomplete:"off",disabled:""},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"题目名称","label-width":"120px"}},[n("el-input",{model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleChecked}},[e._v("保 存")])],1)],1)},staticRenderFns:[]},d=n("VU/8")({data:function(){return{index:null,visible:!1,loading:!1,title:null,code:null}},methods:{handleOpen:function(e,t){this.code=t.code,this.title=t.title,this.state=t.state,this.index=e,this.visible=!0,this.loading=!1},handleCancel:function(){this.visible=!1},handleChecked:function(){this.$emit("completed",{code:this.code,index:this.index,state:this.state,title:this.title}),this.visible=!1},handleClose:function(e){var t=this;this.$confirm("确认关闭？").then(function(n){t.visible=!1,e()}).catch(function(e){})}},components:{}},c,!1,null,null,null).exports,u=n("8BMS"),h=n("tLnF"),p={data:function(){return{visible:!1,info:{type:null}}},methods:{handleOpen:function(e){this.visible=!0,this.info=e}},components:{ChoiceProblem:u.a,ProgramProblem:h.a}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"预览",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[0===e.info.type?n("ChoiceProblem",{attrs:{default_code:e.info.code}}):e._e(),e._v(" "),1===e.info.type?n("ProgramProblem",{attrs:{default_code:e.info.code}}):e._e()],1)},staticRenderFns:[]},m=n("VU/8")(p,f,!1,null,null,null).exports,b=n("BO1k"),v=n.n(b),_={data:function(){return{count:{},data:[],refreshHandle:null,selectedTabName:"first"}},props:["code"],methods:{stop_refresh:function(){clearTimeout(this.refreshHandle),this.refreshHandle=null},refresh:function(){var e=this;this.$http.post("/api/problem/choice_problem/gather",{code:this.code}).then(function(t){e.count={},e.data=t.body.results;var n=!0,i=!1,o=void 0;try{for(var l,a=v()(t.body.results);!(n=(l=a.next()).done);n=!0){var s=l.value;void 0===e.count[s.answer]&&(e.count[s.answer]=0),e.count[s.answer]+=1}}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}var r=echarts.init(document.getElementById("board")),c={name:"选择统计",data:[]};for(var d in e.count)c.data.push({name:d,value:e.count[d]});c.type="pie",c.radius="75%",r.setOption({series:c})}).catch(function(e){}),this.refreshHandle=setTimeout(this.refresh,2e3)}},mounted:function(){this.refresh()},components:{}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tabs",{model:{value:e.selectedTabName,callback:function(t){e.selectedTabName=t},expression:"selectedTabName"}},[n("el-tab-pane",{attrs:{label:"选项整理",name:"first"}},[n("div",{staticStyle:{margin:"auto"}},[n("div",{staticStyle:{margin:"auto",width:"300px",height:"280px"},attrs:{id:"board"}})])]),e._v(" "),n("el-tab-pane",{attrs:{label:"详细情况",name:"second"}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.data}},[n("el-table-column",{attrs:{prop:"id",label:"#ID",width:"180"}}),e._v(" "),n("el-table-column",{attrs:{prop:"realname",label:"姓名",width:"180"}}),e._v(" "),n("el-table-column",{attrs:{prop:"answer",label:"选项"}})],1)],1)],1)},staticRenderFns:[]},y=n("VU/8")(_,g,!1,null,null,null).exports,w={data:function(){return{text:"",data:[]}},props:["code"],methods:{handleItemClick:function(e){this.$refs.render.handleLocate(e)}},mounted:function(){var e=this;this.$http.post("/api/problem/program_problem/gather",{code:this.code}).then(function(t){e.data=t.body.results}).catch(function(e){})},components:{ProgramProblemRender:h.a}},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"min-height":"300px"}},[n("div",[e._v("\n\t\t"+e._s(e.text)+"\n\t")]),e._v(" "),n("el-dropdown",{on:{command:e.handleItemClick}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n\t\t\t浏览学生"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.data,function(t){return n("el-dropdown-item",{key:t.code,attrs:{command:t.code}},[e._v(e._s(t.realname))])}))],1),e._v(" "),n("ProgramProblemRender",{ref:"render"})],1)},staticRenderFns:[]},$={data:function(){return{visible:!1,info:{type:null}}},methods:{handleOpen:function(e){this.visible=!0,this.info=e},handleClose:function(e){e&&0===e.type&&this.$refs.choice_analyze.stop_refresh()}},components:{ChoiceProblemAnalyze:y,ProgramProblemAnalyze:n("VU/8")(w,x,!1,null,null,null).exports}},C={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"数据分析",visible:e.visible},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[0===e.info.type?n("ChoiceProblemAnalyze",{ref:"choice_analyze",attrs:{code:e.info.code}}):e._e(),e._v(" "),1===e.info.type?n("ProgramProblemAnalyze",{ref:"problem_analyze",attrs:{code:e.info.code}}):e._e()],1)},staticRenderFns:[]},P=n("VU/8")($,C,!1,null,null,null).exports,k={data:function(){return{loading:!1,class_id:this.$route.params.class_id,problemData:[]}},props:["course_status"],mounted:function(){this.reload()},computed:{},methods:{reload:function(){this.$http.post("/api/problem/list",{class_id:this.class_id,type:"teacher"}).then(function(e){this.problemData=e.body.results,this.problemData.forEach(function(e,t){e.index=t+1,0==e.type&&(e.type_title="选择题"),1==e.type&&(e.type_title="程序题")})}).catch(function(e){this.$message(e)})},tableRowClassName:function(e){var t=e.row;e.rowIndex;return 1===t.state?"published":2===t.state?"ended":""},handlePublish:function(e,t,n){var i=this;this.$http.post("/api/problem/state/set",{state:n,code:t.code}).then(function(e){return i.$http.post("/api/class/cache/set",{class_id:i.class_id,entry:"PROBLEM",data:o()({code:t.code,type:t.type})})}).then(function(e){1===n&&i.$socket.emit("alert",{operation:"PROBLEM_PUBLISH.",course_id:i.class_id,problem_code:t.code,info:{type:t.type,code:t.code},echo:!0}),i.$socket.emit("alert",{operation:"REFRESH.",course_id:i.class_id,target:"train_area",echo:!0}),i.$message("题目已经发布!"),i.reload()}).catch(function(e){})},handleDelete:function(e){this.$http.post("/api/problem/delete",{code:e.code}).then(function(e){window.location.href=window.location.href}).catch(function(e){})},handleAnalyze:function(e,t){this.$refs.prob_analyze.handleOpen(t)},handleChoiceDialogCompleted:function(e){this.problemData[e.index].title=e.title,this.$http.post("/api/problem/save",{code:e.info.code,state:e.state,title:e.title}).then(function(e){}).catch(function(e){})},handleProgramDialogCompleted:function(e){this.problemData[e.index].title=e.title,this.$http.post("/api/problem/save",{code:e.code,state:e.state,title:e.title}).then(function(e){}).catch(function(e){})},handleContentEditByPID:function(e,t){var n=this,i=void 0;0==e.type?i="choice_problems":1==e.type&&(i="program_problems"),this.$http.post("/api/problem/table/"+i+"/get",{code:e.code}).then(function(e){var i=e.body.results[0][t];n.$refs.content_editor.handleOpen(i)}).catch(function(e){n.$message("未知错误")})},handleCreate:function(e){var t=this;this.loading=!0,this.$http.post("/api/problem/create",{class_id:this.class_id,type:e}).then(function(e){return t.$http.post("/api/problem/list",{class_id:t.class_id,type:"teacher"})}).then(function(e){t.problemData=e.body.results,t.problemData.forEach(function(e,t){e.index=t+1,0==e.type&&(e.type_title="选择题"),1==e.type&&(e.type_title="程序题")}),t.loading=!1}).catch(function(e){t.loading=!1})},handleEdit:function(e,t){var n=null;0==t.type&&(n="dialog_choice"),1==t.type&&(n="dialog_program"),this.$refs[n].handleOpen(e,t)},handlePreview:function(e,t){this.$refs.prob_preview.handleOpen(t)}},components:{ChoiceProblemDialog:r,ProgramProblemDialog:d,ContentEditor:l.a,Preview:m,Analyze:P}},D={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:24}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.problemData,"row-class-name":e.tableRowClassName}},[n("el-table-column",{attrs:{prop:"index",label:"编号",width:"60"}}),e._v(" "),n("el-table-column",{attrs:{prop:"title",label:"题目",width:"200"}}),e._v(" "),n("el-table-column",{attrs:{prop:"type_title",label:"类型",width:"80"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",disabled:1===t.row.state},on:{click:function(n){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{size:"mini",disabled:1===t.row.state},on:{click:function(n){e.handleContentEditByPID(t.row,"description")}}},[e._v("描述")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(n){e.handlePreview(t.$index,t.row)}}},[e._v("答案")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:function(n){e.handleAnalyze(t.$index,t.row)}}},[e._v("统计")]),e._v(" "),0===t.row.state?n("el-button",{attrs:{size:"mini"},on:{click:function(n){e.handlePublish(t.$index,t.row,1)}}},[e._v("发布")]):e._e(),e._v(" "),1===t.row.state||2===t.row.state?n("el-button",{attrs:{size:"mini"},on:{click:function(n){e.handlePublish(t.$index,t.row,0)}}},[e._v("重置")]):e._e(),e._v(" "),n("el-button",{attrs:{size:"mini",disabled:1!==t.row.state},on:{click:function(n){e.handlePublish(t.$inedx,t.row,2)}}},[e._v("结束")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1)],1),e._v(" "),n("el-row",[n("el-button",{on:{click:function(t){e.handleCreate(0)}}},[e._v(" 新建选择题 ")]),e._v(" "),n("el-button",{on:{click:function(t){e.handleCreate(1)}}},[e._v(" 新建程序题 ")])],1),e._v(" "),n("ChoiceProblemDialog",{ref:"dialog_choice",on:{completed:e.handleChoiceDialogCompleted}}),e._v(" "),n("ProgramProblemDialog",{ref:"dialog_program",on:{completed:e.handleProgramDialogCompleted}}),e._v(" "),n("ContentEditor",{ref:"content_editor"}),e._v(" "),n("Preview",{ref:"prob_preview"}),e._v(" "),n("Analyze",{ref:"prob_analyze"})],1)},staticRenderFns:[]};var E=n("VU/8")(k,D,!1,function(e){n("TUtW")},null,null);t.default=E.exports},TUtW:function(e,t){}});
//# sourceMappingURL=16.96d6ca5eb383e0aa018e.js.map