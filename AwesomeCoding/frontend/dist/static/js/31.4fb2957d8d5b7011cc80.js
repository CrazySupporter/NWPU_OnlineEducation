webpackJsonp([31],{"/1WC":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l={data:function(){return{tableData:[],class_id:"undefined",inputData:{userId:void 0,classId:void 0},page:!0,activeIndex:"1",upload:!1}},mounted:function(){this.class_id=this.$route.params.class_id,this.inputData.classId=this.class_id,this.loadTableData(!0)},methods:{loadTableData:function(t){this.$http.post("/api/file/fetch",{}).then(function(e){this.$http.post("/api/file/fetch_coursefiles",{classid:this.class_id}).then(function(a){this.page=t,this.tableData=[];for(var l=0;l<e.body.results.length;l++){for(var i=0,s=0;s<a.body.results.length;s++)if(a.body.results[s].file_id===e.body.results[l].id){i=1;break}0===i&&!0===t?this.tableData.push(e.body.results[l]):1===i&&!1===t&&this.tableData.push(e.body.results[l])}for(var n=0;n<this.tableData.length;n++)this.tableData[n].showFilename=this.tableData[n].filename.slice(32)})})},handleAdd:function(t){this.$http.post("/api/file/add_to_course",{classid:this.inputData.classId,fileid:t.id,filename:t.filename}).then(function(t){this.loadTableData(!0)})},handleDelete:function(t){this.$http.post("/api/file/delete_from_course",{classid:this.inputData.classId,fileid:t.id}).then(function(t){this.loadTableData(!1)})},handlePageAdd:function(){this.upload=!1,this.loadTableData(!0)},handlePageDelete:function(){this.upload=!1,this.loadTableData(!1)},handlePageUpload:function(){this.upload=!0},handleView:function(t){var e=this;t.filename.indexOf("pdf")>=0?this.$http.post("/api/class/cache/set",{class_id:this.class_id,entry:"FILE_NAME",data:"/uploads/"+t.filename}).then(function(a){e.$socket.emit("alert",{operation:"CHANGE_PDF.",pdfSrc:"/uploads/"+t.filename,course_id:e.class_id,echo:!0})}):alert("请选择pdf文件")}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",[a("el-main",[a("el-menu",{attrs:{"default-active":t.activeIndex,mode:"horizontal"}},[a("el-menu-item",{attrs:{index:"1"},on:{click:function(e){t.handlePageAdd()}}},[t._v("添加到课程")]),t._v(" "),a("el-menu-item",{attrs:{index:"2"},on:{click:function(e){t.handlePageDelete()}}},[t._v("从课程删除")]),t._v(" "),a("el-menu-item",{attrs:{index:"3"},on:{click:function(e){t.handlePageUpload()}}},[t._v("上传文件")])],1),t._v(" "),!1===t.upload?a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData}},[a("el-table-column",{attrs:{prop:"showFilename",label:"文件名",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[!0===t.page?a("el-button",{attrs:{icon:"el-icon-check",circle:""},on:{click:function(a){t.handleAdd(e.row)}}}):a("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:function(a){t.handleDelete(e.row)}}}),t._v(" "),a("el-button",{attrs:{icon:"el-icon-view",circle:""},on:{click:function(a){t.handleView(e.row)}}})]}}])})],1):t._e(),t._v(" "),!0===t.upload?a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"/api/file/upload",multiple:""}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])]),t._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("tip: 所有文件在个人页可管理")])]):t._e()],1)],1)},staticRenderFns:[]},s=a("VU/8")(l,i,!1,null,null,null);e.default=s.exports}});
//# sourceMappingURL=31.4fb2957d8d5b7011cc80.js.map