webpackJsonp([4],{"9OfN":function(e,t){},CdmB:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n("yXWK"),r=(o=a)&&o.__esModule?o:{default:o};var s={nFrequencyBars:255,onAnalysed:null},c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({},s,n),this.audioContext=t,this.audioInput=null,this.realAudioInput=null,this.inputPoint=null,this.audioRecorder=null,this.rafID=null,this.analyserContext=null,this.recIndex=0,this.stream=null,this.updateAnalysers=this.updateAnalysers.bind(this)}return i(e,[{key:"init",value:function(e){var t=this;return new Promise(function(n){t.inputPoint=t.audioContext.createGain(),t.stream=e,t.realAudioInput=t.audioContext.createMediaStreamSource(e),t.audioInput=t.realAudioInput,t.audioInput.connect(t.inputPoint),t.analyserNode=t.audioContext.createAnalyser(),t.analyserNode.fftSize=2048,t.inputPoint.connect(t.analyserNode),t.audioRecorder=new r.default(t.inputPoint);var o=t.audioContext.createGain();o.gain.value=0,t.inputPoint.connect(o),o.connect(t.audioContext.destination),t.updateAnalysers(),n()})}},{key:"start",value:function(){var e=this;return new Promise(function(t,n){e.audioRecorder?(e.audioRecorder.clear(),e.audioRecorder.record(),t(e.stream)):n("Not currently recording")})}},{key:"stop",value:function(){var e=this;return new Promise(function(t){e.audioRecorder.stop(),e.audioRecorder.getBuffer(function(n){e.audioRecorder.exportWAV(function(e){return t({buffer:n,blob:e})})})})}},{key:"updateAnalysers",value:function(){if(this.config.onAnalysed){requestAnimationFrame(this.updateAnalysers);var e=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(e);for(var t=new Array(255),n=0,o=void 0,i=0;i<255;i+=1)0!==(o=Math.floor(e[i])-Math.floor(e[i])%5)&&(n=i),t[i]=o;this.config.onAnalysed({data:t,lineTo:n})}}},{key:"setOnAnalysed",value:function(e){this.config.onAnalysed=e}}]),e}();c.download=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"audio";r.default.forceDownload(e,t+".wav")},t.default=c},OCva:function(e,t){},fr6i:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("BO1k"),i=n.n(o),a={name:"EditDialog",props:{config:Object},methods:{handleOpened:function(){},cancel:function(){this.config.visible=!1,this.config.response=!1},confirm:function(){this.config.visible=!1,this.config.response=!0}}},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{id:"dialog-test",title:e.config.title,visible:e.config.visible},on:{"update:visible":function(t){e.$set(e.config,"visible",t)},open:e.handleOpened,close:function(t){e.$emit("dialogClose")}}},[n("h1",[e._t("h1",[e._v(e._s(e.config.title))])],2),e._v(" "),n("p"),e._v(" "),e._t("default",[e._v(e._s(e.config.content))]),e._v(" "),n("p"),e._v(" "),n("el-input",{attrs:{placeholder:"输入..."},model:{value:e.config.input,callback:function(t){e.$set(e.config,"input",t)},expression:"config.input"}}),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 认")])],1)],2)},staticRenderFns:[]};var s=n("VU/8")(a,r,!1,function(e){n("9OfN")},"data-v-578dc1ea",null).exports,c=n("hng7"),u=n.n(c),l={name:"Test",data:function(){var e=new Date,t=new Date;return t.setTime(e.getTime()+6e4),{host:{host1:window.location.host,host2:document.domain},my_url:window.location.href,my_protocol:window.location.protocol,my_path:location.pathname,input:"",dialog:{title:"一个平凡的标题",content:"一个平凡的段落。",visible:!1,input:"",response:!1},showColumn:!0,cookies:[],exp_secs:120,new_cookie:{name:"",value:""},cur_date:e.toUTCString(),cur_date2:t.toUTCString(),recorder:void 0,blob:void 0}},sockets:{alert:function(e){this.$notify.warning({title:"收到通知",message:e.content}),"SHOW_DIALOG."===e.operation&&(this.dialog.visible=!0,this.dialog.title=e.operation,this.dialog.content=e.content)}},methods:{handleCreate:function(){var e=this,t=new(window.AudioContext||window.webkitAudioContext);this.recorder=new u.a(t,{}),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){return e.recorder.init(t)}).catch(function(e){return console.log("Uh oh... unable to get stream...",e)}),console.log("[new recorder]",this.recorder),this.$message.success("录制器已创建")},handleStartRecording:function(){var e=this;this.recorder.start().then(function(){e.$message("开始录制")})},handleStopRecording:function(){var e=this;this.recorder.stop().then(function(t){var n=t.blob,o=t.buffer;e.$message("结束录制"),console.log("[stop recording]",n,o),e.blob=n})},handleDownload:function(){u.a.download(this.blob,"my-audio-file")},handleDestroy:function(){delete this.recorder,this.$message.success("录制器已删除")},createDialog:function(){this.dialog.visible=!0,this.dialog.input=this.input},handleClose:function(){!0===this.dialog.response&&(this.input=this.dialog.input)},getCookies:function(){var e,t;e=document.cookie.split(";"),this.cookies=[];var n=!0,o=!1,a=void 0;try{for(var r,s=i()(e);!(n=(r=s.next()).done);n=!0)t=r.value,this.cookies.push(t.trim())}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}},createCookie:function(){var e,t=new Date;t.setTime(t.getTime()+1e3*this.exp_secs),e=this.new_cookie.name+"="+this.new_cookie.value+";expires="+t.toUTCString(),document.cookie=e,this.getCookies()},handleAlert:function(){var e={course_id:7,operation:"SHOW_DIALOG.",content:"教师这边的时间："+(new Date).toTimeString()};this.$socket.emit("alert",e),this.$message.info("正在广播给学生  "+e.content)}},components:{EditDialog:s}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"test-view"}},[n("el-button",{on:{click:e.handleCreate}},[e._v("创建录音器")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleStartRecording}},[e._v("开始录音")]),e._v(" "),n("el-button",{attrs:{type:"error"},on:{click:e.handleStopRecording}},[e._v("结束录音")]),e._v(" "),n("el-button",{attrs:{type:"success"},on:{click:e.handleDownload}},[e._v("下载录音")]),e._v(" "),n("el-button",{on:{click:e.handleDestroy}},[e._v("删除录音器")]),e._v(" "),n("el-button",{on:{click:e.handleAlert}},[e._v("学生看过来！")])],1)},staticRenderFns:[]};var f=n("VU/8")(l,d,!1,function(e){n("OCva")},"data-v-88783d3e",null);t.default=f.exports},hng7:function(e,t,n){e.exports=n("CdmB")},vMSS:function(e,t,n){(function(t){var n=!!(t===t.window&&t.URL&&t.Blob&&t.Worker);function o(e,o){var i,a=this;if(o=o||{},n)return i=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new t.Worker(t.URL.createObjectURL(new t.Blob([i],{type:"text/javascript"})));this.self=o,this.self.postMessage=function(e){setTimeout(function(){a.onmessage({data:e})},0)},setTimeout(e.bind(o,o),0)}o.prototype.postMessage=function(e){var t=this;setTimeout(function(){t.self.onmessage({data:e})},0)},e.exports=o}).call(t,n("DuR2"))},yXWK:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n("vMSS"),r=(o=a)&&o.__esModule?o:{default:o};var s={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},c=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=Object.assign({},s,n),this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},this.context=t.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(e){if(o.recording){for(var t=[],n=0;n<o.config.numChannels;n++)t.push(e.inputBuffer.getChannelData(n));o.worker.postMessage({command:"record",buffer:t})}},t.connect(this.node),this.node.connect(this.context.destination);this.worker=new r.default(function(){var e=0,t=[],n=void 0,o=void 0;function i(){for(var e=0;e<o;e++)t[e]=[]}function a(e,t){for(var n=new Float32Array(t),o=0,i=0;i<e.length;i++)n.set(e[i],o),o+=e[i].length;return n}function r(e,t,n){for(var o=0;o<n.length;o+=1)e.setUint8(t+o,n.charCodeAt(o))}this.onmessage=function(s){switch(s.data.command){case"init":c=s.data.config,n=c.sampleRate,o=c.numChannels,i();break;case"record":!function(n){for(var i=0;i<o;i++)t[i].push(n[i]);e+=n[0].length}(s.data.buffer);break;case"exportWAV":!function(i){for(var s=[],c=0;c<o;c++)s.push(a(t[c],e));var u=void 0;u=2===o?function(e,t){var n=e.length+t.length,o=new Float32Array(n),i=0,a=0;for(;i<n;)o[i++]=e[a],o[i++]=t[a],a++;return o}(s[0],s[1]):s[0];var l=(f=u,h=new ArrayBuffer(44+2*f.length),p=new DataView(h),r(p,0,"RIFF"),p.setUint32(4,36+2*f.length,!0),r(p,8,"WAVE"),r(p,12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,1,!0),p.setUint16(22,o,!0),p.setUint32(24,n,!0),p.setUint32(28,4*n,!0),p.setUint16(32,2*o,!0),p.setUint16(34,16,!0),r(p,36,"data"),p.setUint32(40,2*f.length,!0),function(e,t,n){for(var o=0;o<n.length;o++,t+=2){var i=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}(p,44,f),p),d=new Blob([l],{type:i});var f,h,p;this.postMessage({command:"exportWAV",data:d})}(s.data.type);break;case"getBuffer":!function(){for(var n=[],i=0;i<o;i++)n.push(a(t[i],e));this.postMessage({command:"getBuffer",data:n})}();break;case"clear":e=0,t=[],i()}var c}},{}),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(e){var t=o.callbacks[e.data.command].pop();"function"==typeof t&&t(e.data.data)}}return i(e,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker.postMessage({command:"exportWAV",type:t})}}]),e}();c.forceDownload=function(e,t){var n=document.createElement("a");n.style="display: none",document.body.appendChild(n);var o=window.URL.createObjectURL(e);n.href=o,n.download=t,n.click(),window.URL.revokeObjectURL(o),document.body.removeChild(n)},t.default=c}});
//# sourceMappingURL=4.de05c1f0cb31917a59e4.js.map