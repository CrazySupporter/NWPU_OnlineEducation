{"version":3,"sources":["webpack:///src/components/resources/FileSettings.vue","webpack:///./src/components/resources/FileSettings.vue?5708","webpack:///./src/components/resources/FileSettings.vue"],"names":["FileSettings","data","tableData","class_id","inputData","userId","undefined","classId","page","activeIndex","upload","mounted","this","$route","params","loadTableData","methods","$http","post","then","lres","classid","fres","i","body","results","length","tag","j","file_id","id","push","_i","showFilename","filename","slice","handleAdd","row","fileid","res","handleDelete","handlePageAdd","handlePageDelete","handlePageUpload","handleView","_this","indexOf","entry","$socket","emit","operation","pdfSrc","course_id","echo","alert","resources_FileSettings","render","_vm","_h","$createElement","_c","_self","attrs","default-active","mode","index","on","click","$event","_v","staticStyle","width","prop","label","align","scopedSlots","_u","key","fn","scope","icon","circle","_e","staticClass","drag","action","multiple","slot","staticRenderFns","Component","__webpack_require__","normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/31.4fb2957d8d5b7011cc80.js","sourcesContent":["<template>\n    <el-container>\n        <el-main>\n            <el-menu :default-active=\"activeIndex\" mode=\"horizontal\">\n                <el-menu-item index=\"1\" @click=\"handlePageAdd()\">添加到课程</el-menu-item>\n                <el-menu-item index=\"2\" @click=\"handlePageDelete()\">从课程删除</el-menu-item>\n                <el-menu-item index=\"3\" @click=\"handlePageUpload()\">上传文件</el-menu-item>\n            </el-menu>\n            <el-table :data=\"tableData\" style=\"width: 100%\" v-if=\"upload===false\">\n            <el-table-column prop=\"showFilename\" label=\"文件名\" width=\"180\"></el-table-column>\n            <el-table-column align=\"center\" label=\"操作\">\n                <template slot-scope=\"scope\">\n                    <el-button icon=\"el-icon-check\" circle\n                               v-if=\"page===true\"\n                           @click=\"handleAdd(scope.row)\">\n                    </el-button>\n                    <el-button icon=\"el-icon-delete\" circle\n                               v-else=\"page===false\"\n                               @click=\"handleDelete(scope.row)\">\n                    </el-button>\n                    <el-button icon=\"el-icon-view\" circle\n                               @click=\"handleView(scope.row)\">\n                    </el-button>\n                </template>\n            </el-table-column>\n            </el-table>\n            <el-upload\n                class=\"upload-demo\"\n                drag\n                action=\"/api/file/upload\"\n                v-if=\"upload===true\"\n                multiple>\n                <i class=\"el-icon-upload\"></i>\n                <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n                <div class=\"el-upload__tip\" slot=\"tip\">tip: 所有文件在个人页可管理</div>\n            </el-upload>\n        </el-main>\n    </el-container>\n</template>\n\n<script>\n\nexport default {\n    data () {\n        return {\n            tableData: [],\n            class_id: \"undefined\",\n            inputData: {\n                userId: undefined,\n                classId: undefined,\n            },\n            page: true,\n            activeIndex: \"1\",\n            upload: false\n        };\n    },\n    mounted: function () {\n        this.class_id = this.$route.params.class_id;\n        this.inputData.classId = this.class_id;\n\n        this.loadTableData(true);\n    },\n    methods: {\n        loadTableData: function (page) {\n            this.$http.post('/api/file/fetch', {}).\n                 then(function (lres) {\n                     this.$http.post('/api/file/fetch_coursefiles', {classid: this.class_id,}).\n                          then(function (fres) {\n                              this.page = page;\n                              this.tableData = [];\n                              for (let i = 0; i < lres.body.results.length; i++) {\n                                  let tag = 0;\n                                  for (let j = 0; j < fres.body.results.length; j++) {\n                                      if (fres.body.results[j].file_id === lres.body.results[i].id) {\n                                          tag = 1;\n                                          break;\n                                      }\n                                  }\n                                  if (tag === 0 && page === true) {\n                                      this.tableData.push(lres.body.results[i]);\n                                  } else if (tag === 1 && page === false) {\n                                      this.tableData.push(lres.body.results[i]);\n                                  }\n                              }\n                              for (let i = 0; i < this.tableData.length; i++) {\n                                  this.tableData[i].showFilename = this.tableData[i].filename.slice(32);\n                              }\n                          });\n                 });\n        },\n        handleAdd: function (row) {\n            this.$http.post('/api/file/add_to_course', {\n                classid: this.inputData.classId,\n                fileid: row.id,\n                filename: row.filename,\n            }).\n                 then(function (res) {\n                     this.loadTableData(true);\n                 });\n        },\n        handleDelete: function (row) {\n            this.$http.post('/api/file/delete_from_course', {\n                classid: this.inputData.classId,\n                fileid: row.id,\n            }).\n                 then(function (res) {\n                     this.loadTableData(false);\n                 });\n        },\n\n        handlePageAdd: function () {\n            this.upload = false;\n            this.loadTableData(true);\n        },\n\n        handlePageDelete: function () {\n            this.upload = false;\n            this.loadTableData(false);\n        },\n        handlePageUpload: function () {\n            this.upload = true;\n        },\n\n        handleView: function (row) {\n            if (row.filename.indexOf(\"pdf\") >= 0) {\n\t\t\t\tthis.$http.post('/api/class/cache/set',{class_id: this.class_id, entry:'FILE_NAME', data:'/uploads/'+row.filename}).then((res) => {\n\t\t\t\t\tthis.$socket.emit('alert', {\n\t\t\t\t\t\toperation: 'CHANGE_PDF.',\n\t\t\t\t\t\tpdfSrc: \"/uploads/\" + row.filename,\n\t\t\t\t\t\tcourse_id: this.class_id,\n\t\t\t\t\t\techo: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\talert(\"请选择pdf文件\");\n\t\t\t}\n\t\t}\n\t}\n};\n</script>\n\n\n\n\n// WEBPACK FOOTER //\n// src/components/resources/FileSettings.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('el-container',[_c('el-main',[_c('el-menu',{attrs:{\"default-active\":_vm.activeIndex,\"mode\":\"horizontal\"}},[_c('el-menu-item',{attrs:{\"index\":\"1\"},on:{\"click\":function($event){_vm.handlePageAdd()}}},[_vm._v(\"添加到课程\")]),_vm._v(\" \"),_c('el-menu-item',{attrs:{\"index\":\"2\"},on:{\"click\":function($event){_vm.handlePageDelete()}}},[_vm._v(\"从课程删除\")]),_vm._v(\" \"),_c('el-menu-item',{attrs:{\"index\":\"3\"},on:{\"click\":function($event){_vm.handlePageUpload()}}},[_vm._v(\"上传文件\")])],1),_vm._v(\" \"),(_vm.upload===false)?_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.tableData}},[_c('el-table-column',{attrs:{\"prop\":\"showFilename\",\"label\":\"文件名\",\"width\":\"180\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"align\":\"center\",\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(_vm.page===true)?_c('el-button',{attrs:{\"icon\":\"el-icon-check\",\"circle\":\"\"},on:{\"click\":function($event){_vm.handleAdd(scope.row)}}}):_c('el-button',{attrs:{\"icon\":\"el-icon-delete\",\"circle\":\"\"},on:{\"click\":function($event){_vm.handleDelete(scope.row)}}}),_vm._v(\" \"),_c('el-button',{attrs:{\"icon\":\"el-icon-view\",\"circle\":\"\"},on:{\"click\":function($event){_vm.handleView(scope.row)}}})]}}])})],1):_vm._e(),_vm._v(\" \"),(_vm.upload===true)?_c('el-upload',{staticClass:\"upload-demo\",attrs:{\"drag\":\"\",\"action\":\"/api/file/upload\",\"multiple\":\"\"}},[_c('i',{staticClass:\"el-icon-upload\"}),_vm._v(\" \"),_c('div',{staticClass:\"el-upload__text\"},[_vm._v(\"将文件拖到此处，或\"),_c('em',[_vm._v(\"点击上传\")])]),_vm._v(\" \"),_c('div',{staticClass:\"el-upload__tip\",attrs:{\"slot\":\"tip\"},slot:\"tip\"},[_vm._v(\"tip: 所有文件在个人页可管理\")])]):_vm._e()],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-92f1120a\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/resources/FileSettings.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./FileSettings.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./FileSettings.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-92f1120a\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./FileSettings.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/resources/FileSettings.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}